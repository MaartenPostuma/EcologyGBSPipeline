---
title: "filtering report"
#code-author: MaartenPostuma
#date: 23-07-2019
output:
  html_document:
    df_print: paged
params:
  dir: "vcf/"
  rmd: "report.Rmd"
---

#### author: `r system("whoami",inter=T)`
#### date: `r system("date",intern=T)`


```{r setup, include=FALSE}
#setwd("./output")
chooseCRANmirror(graphics=FALSE, ind=33)
args <- commandArgs(TRUE)
usePackage <- function(p) 
{
  if (!is.element(p, installed.packages()[,1]))
    install.packages(p, dep = TRUE)
  require(p, character.only = TRUE)
}
usePackage("ggplot2")
usePackage("ggpubr")
usePackage("knitr")
usePackage("ggdendro")
usePackage("shiny")
usePackage("ggrepel")

options(stringsAsFactors = FALSE)

knitr::opts_chunk$set(echo = FALSE)
options(tinytex.verbose = TRUE)
```

This report contains all the information needed to make descisions about your filtering steps.

# Filter Steps {.tabset .tabset-fade .tabset-pills}

## First Steps

Here you can find the information from the log files of the first 2 filtering steps:

```{bash capture="step 1 log"}
cat ./vcf/step1.log | grep -v "VCFtools" | grep -v "(C)" | grep -v "Individuals" | grep -v "Outputting"| grep -v "Run Time"
```

The distribution of individual missingness

```{r fig.cap="Fig.1: Histogram of the fraction of missingness across individuals, red line indicates the cutoff used in filtering step 2"}
indCoverage<-read.table("vcf/missingIndvs.imiss",h=T)
cutOff<-as.numeric(system("cat configFiltering.yaml | grep 'individual_missingness'| cut -f2 -d :",intern=T))
numberOfIndividuals<-system("cat vcf/step2.log|grep 'Individuals' ",intern=T)
ggplot(indCoverage,aes(x=F_MISS))+geom_histogram(col="black",fill="lightblue",binwidth=0.025)+
  ggtitle(numberOfIndividuals)+ylab("fraction missing")+
  theme_light()+geom_vline(xintercept=cutOff,col="red")
```

These are the individuals that are excluded from further analysis

```{bash capture="missing individuals"}
cat ./vcf/lowDP.step2.indv
```

## PCA {.tabset .tabset-fade .tabset-pills}
#### PCA

```{r,message=FALSE,results='hide',error=TRUE, fig.cap=paste("PCAs)}

```
