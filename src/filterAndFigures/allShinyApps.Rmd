#This very much does not work yet, and may possible never work. But we could use this to publish the plots for the workshop!


---
title: "test"
author: "MaartenPostuma"
date: "2024-02-22"
output: html_document
runtime: shiny

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
usePackage <- function(p) 
{
  if (!is.element(p, installed.packages()[,1]))
    install.packages(p, dep = TRUE,repos = "https://cloud.r-project.org")
  require(p, character.only = TRUE)
}
usePackage("rsconnect")
usePackage("ggplot2")
usePackage("ggpubr")
usePackage("knitr")
usePackage("ggdendro")
usePackage("shiny")
usePackage("ggrepel")

rsconnect::setAccountInfo(name='31zg4d-maartenpostuma',
			  token='C263811EC365606564A823EC92307DC8',
			  secret='5J8JuNzgQzfU/whG3LwExGy2Cj00fj+l5qdRh9gb')
```


```{r pressure, echo=FALSE}
library(shiny)
library(ggplot2)
library(ggrepel)
library(ggpubr)
dataSet<-read.table("../results/pcaAll.tsv",h=T)
vars=names(dataSet)

shinyApp(
  ui = fluidPage(
    fluidRow(style = "padding-bottom: 20px;",
             column(4, selectInput('xcol', 'X Variable', vars[3:5],selected = vars[3])),
             column(4, selectInput('ycol', 'Y Variable', vars[3:5],selected = vars[4])),
             column(4, selectInput('maf', 'maf',unique(dataSet$maf))),
             column(4, selectInput('max_missing', 'max_missing',unique(dataSet$max_missing)))
    ),
    fluidRow(
      plotOutput('pca', height = "400px")  
    )
  ),
  
  server = function(input, output, session) {
    
    # Combine the selected variables into a new data frame
    selectedData = reactive({
      dataSet[dataSet$maf==input$maf&dataSet$max_missing==input$max_missing, c(input$xcol, input$ycol,"metaPop","pop","PCA1Var","PCA2Var","PCA3Var")]
    })
    
    
    output$pca = renderPlot(height = 400, {
      ggplot(data=selectedData(),aes(x=selectedData()[,input$xcol],y=selectedData()[,input$ycol],
                                     col=selectedData()[,"metaPop"],label=selectedData()[,"pop"]))+
        theme_pubclean()+
        geom_point()+
        geom_text_repel(col="black")+
        xlab(paste0(input$xcol," (",round(unique(selectedData()[,paste0(input$xcol,"Var")],1)*100),"%)"))+
        ylab(paste0(input$ycol," (",round(unique(selectedData()[,paste0(input$ycol,"Var")],1)*100),"%)"))
      
    })
  },
  
  options = list(height = 500)
)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
